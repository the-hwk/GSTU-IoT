## Лабораторная работа

**Система *Home Assistant*. Подключение и управление устройствами умного дома. Протокол *Zigbee***

**Цель работы:** знакомство с системой *Home Assistant* и протоколом *Zigbee*. Подключение и управление устройствами умного дома с использованием протокола *Zigbee*.

**Задание:** выполнить развертывание системы *Home Assistant*, подключить несколько устройств умного дома с использованием протокола *Zigbee*. Придумать и реализовать сценарий взаимодействия нескольких устройств.

*Примечание: данные для аутентификации и авторизации в системе Home Assistant уточнить у преподавателя.*

### Теоретические сведения

***Home Assistant***

*Home Assistant* - это система автоматизации умного дома с открытым исходным кодом, предназначенная для управления устройствами умного дома в едином интерфейсе. Она устанавливается локально, чаще всего на одноплатных компьютерах и работает без необходимости постоянного подключения к облаку.

*Home Assistant* поддерживает множество интеграций с устройствами умного дома, такими как лампы, розетки, датчики, термостаты, камеры и голосовые помощники. Подключение и управление устройствами осуществляется через веб-интерфейс. В *Home Assistant* можно создавать автоматизации - правила, по которым система будет реагировать на события (например, включать свет при движении или регулировать температуру по расписанию).

**Протокол *Zigbee***

Устройства умного дома управляются через различные протоколы связи, обеспечивающие их взаимодействие и централизованное управление. Одним из популярных протоколов, поддерживаемых *Home Assistant*, является *Zigbee*. 

*Zigbee* - это энергоэффективный беспроводной протокол, предназначенный для соединения большого количества устройств в единую *mesh*-сеть, в которой устройства могут передавать сигналы друг через друга, расширяя зону покрытия и повышая надежность связи.

Для связи *Zigbee*-устройств с *Home Assistant* необходим специальный *USB*-адаптер (координатор), часто называемый *Zigbee*-антенной. Он подключается к серверу, на котором установлен *Home Assistant*, и выполняет роль центрального узла сети, принимая и передавая сигналы от устройств.

**Развертывание системы *Home Assistant***

Используемые компоненты:
- источник питания (*Powerbank*)
- роутер
- одноплатный компьютер с установленной системой *Home Assistant*
- *USB*-адаптер *Zigbee*
- ПК для взаимодействия с *Home Assistant* через веб-интерфейс

Подготовка:
- подключить роутер и одноплатный компьютер к источнику питания
- подключить одноплатный компьютер к роутеру с помощью *Ethernet*-кабеля
- вставить *USB*-адаптер *Zigbee* в *USB*-порт одноплатного компьютера
- система *Home Assistant* автоматически запустится в течении 5-10 минут

Взаимодействие с *Home Assistant* через веб-интерфейс:
- подключиться к локальной сети (к роутеру) по *Wi-Fi*: `TP-Link_E238`
	- пароль уточнить у преподавателя
- открыть веб-браузер и выполнить запрос по *URL*: http://192.168.1.102:8123/. В результате откроется страница входа в *Home Assistant*. Далее войти в аккаунт
- для добавления нового *Zigbee*-устройства необходимо:
	- перейти в настройки (в меню, расположенном в левой части страницы), далее "Устройства и службы" и перейти на вкладку "Устройства" (вверху)
	- перед добавлением нового устройства необходимо перевести его в режим сопряжения (можно прочитать в инструкции или уточнить у преподавателя)
	- далее необходимо нажать на кнопку "Добавить устройство". При добавлении не забываем задать название (любое)
	- после добавления устройства можно посмотреть его состояние, задать автоматизации, сцены и скрипты
- автоматизация - можно задать действия, выполняемые при изменении состояния устройства
	- например, если датчик движения активирован (обнаружил движение), то включить лампу
- сцены - можно задать варианты состояний устройства
	- например, для *RGB*-лампы можно задать несколько сцен с различными цветами и яркостью, а затем использовать эти сцены в автоматизации (например, если показатель датчика температуры составляет более 20 градусов, то установить цвет лампы желтым, иначе синим)
